import React from 'react';
import { useState } from "react"; import { FormInputField } from "../../FormInputField"; import {   Btn,   BtnBox,   Container,   Divider,   Form,   ModalTitle, } from "../../Modal.style"; import {   ProfileImgDiv,   ProfileImgContainer,   CameraIcon,   ImageCancel, } from "../SignUpModal.style"; import {   checkDuplicatedNickname,   signUp, } from "../../../../services/api/authApi"; import { imageUpload } from "../../../../services/api/imageApi"; import profileIcon from "../../../../assets/images/profileImg.png"; import cameraIcon from "../../../../assets/images/camera.png"; import { ProfileImg } from "./UserDetailsInputForm.style"; import { ErrMsg } from "../../../../assets/styles/ErrMsg.style"; function UserDetailsInputForm({ email, closeModal, changeModal }) {   const [previewImage, setPreviewImage] = useState(null);   const [profileImg, setProfileImg] = useState("");   const [nickname, setNickname] = useState("");   const [password, setPassword] = useState("");   const [confirmPassword, setConfirmPassword] = useState("");   const [phoneNumber, setPhoneNumber] = useState("");   const [errors, setErrors] = useState({});    const validateForm = async () => {     try {       let errors = {};       if (password.length < 8 || password.length > 16) {         errors.password = "ë¹„ë?ë²ˆí˜¸??8ê¸€???´ìƒ 16ê¸€???´í•˜?´ì–´???©ë‹ˆ??";       }        if (         !/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_\-+=~`{}\[\]:;"'<>,.?/\\|]).+$/.test(           password         )       ) {         errors.password = "ë¹„ë?ë²ˆí˜¸???ë¬¸, ?«ì, ?¹ìˆ˜ë¬¸ìë¥??¬í•¨?´ì•¼ ?©ë‹ˆ??";       }        if (password !== confirmPassword) {         errors.confirmPassword = "ë¹„ë?ë²ˆí˜¸ê°€ ?¼ì¹˜?˜ì? ?ŠìŠµ?ˆë‹¤.";       }        if (!/^\d{3}-\d{4}-\d{4}$/.test(phoneNumber)) {         errors.phoneNumber = "?„í™”ë²ˆí˜¸ ?•ì‹??ë§ì¶°ì£¼ì„¸?? ?? 010-1234-1234";       }        setErrors(errors);       return Object.keys(errors).length === 0;     } catch (err) {       errors.nickname = err.message || "?‰ë„¤??ê´€???ëŸ¬ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.";     }   };    const handleNicknameBlur = async (value) => {     console.log("handleNicknameBlur ?¸ì¶œ??", value);      if (value.length < 2 || value.length > 20) {       console.log("?‰ë„¤??ê¸¸ì´ ì¡°ê±´ ?¤íŒ¨");       setErrors((prev) => ({         ...prev,         nickname: "?‰ë„¤?„ì? 2ê¸€?ë???20ê¸€?ê¹Œì§€ ê°€?¥í•©?ˆë‹¤.",       }));       return;     }      try {       const isDuplicated = await checkDuplicatedNickname(value);        if (isDuplicated) {         setErrors((prev) => ({           ...prev,           nickname: "ì¤‘ë³µ???‰ë„¤?„ì…?ˆë‹¤.",         }));       } else {         setErrors((prev) => {           const { nickname, ...rest } = prev;           return rest; // ?‰ë„¤???ëŸ¬ ?œê±°         });       }     } catch (err) {       console.error("API ?¸ì¶œ ?¤íŒ¨:", err);       setErrors((prev) => ({         ...prev,         nickname: "API ?¸ì¶œ ?¤íŒ¨: ?‰ë„¤???•ì¸ ì¤??¤ë¥˜ê°€ ë°œìƒ?ˆìŠµ?ˆë‹¤.",       }));     }   };    async function handleSignUp(e) {     e.preventDefault();      const isValid = await validateForm();      if (isValid) {       try {         if (profileImg === "") {           let body = {             email,             password,             nickname,             imageKey: "default-image/users/default-profile.png",             phoneNumber,           };           const response = await signUp(body);           console.log(response);         } else {           let body = {             email,             password,             nickname,             imageKey: profileImg,             phoneNumber,           };           const response = await signUp(body);           console.log(response);         }          changeModal("login");       } catch (err) {         console.log(err);       }     } else {       return;     }   }    const handleImageChange = async (e) => {     const file = e.target.files[0];     if (!file) {       alert("?Œì¼??? íƒ?´ì£¼?¸ìš”.");       return;     }     try {       const response = await imageUpload("PROFILE", file);       if (response?.fileKey) {         setPreviewImage(response.accessImage);         setProfileImg(response.fileKey);       } else {         console.error("Invalid response format:", response);         alert("?´ë?ì§€ ?…ë¡œ???¤íŒ¨: ?œë²„ ?‘ë‹µ ?¤ë¥˜");       }     } catch (error) {       console.error("Image upload failed:", error);       alert("?´ë?ì§€ ?…ë¡œ?œì— ?¤íŒ¨?ˆìŠµ?ˆë‹¤. ?¤ì‹œ ?œë„?´ì£¼?¸ìš”.");     }   };    return (     <Container>       <ModalTitle>         <h1>?Œì›ê°€??/h1>       </ModalTitle>       <Form onSubmit={handleSignUp}>         <ProfileImgDiv>           <ProfileImgContainer>             <label htmlFor="profileImgInput">               <ProfileImg                 src={previewImage ? previewImage : profileIcon}                 alt="?„ë¡œ?„ì‚¬ì§?                 $default={!previewImage}               />               <CameraIcon src={cameraIcon} alt="ì¹´ë©”???„ì´ì½? />             </label>             <input               id="profileImgInput"               type="file"               onChange={handleImageChange}               style={{ display: "none" }}             />           </ProfileImgContainer>            <ImageCancel             onClick={() => {               setPreviewImage(null);               setProfileImg("");             }}           >             ì·¨ì†Œ           </ImageCancel>         </ProfileImgDiv>         <div>           <FormInputField             label={"?‰ë„¤??}             type={"text"}             value={nickname}             onChange={(e) => setNickname(e.target.value)}             onBlur={(e) => handleNicknameBlur(e.target.value)}             placeholder={"?‰ë„¤?„ì? 2ê¸€?ë???20ê¸€?ê¹Œì§€ ê°€?¥í•©?ˆë‹¤."}           />           {errors.nickname && <ErrMsg>{errors.nickname}</ErrMsg>}         </div>          <div>           <FormInputField             label={"ë¹„ë?ë²ˆí˜¸"}             type={"password"}             value={password}             onChange={(e) => setPassword(e.target.value)}             hasError={errors.password}             placeholder={               "8ê¸€?ë???16ê¸€???ì–´ ?Œë¬¸???¹ìˆ˜ë¬¸ì,?«ìë¥?ì¡°í•©?´ì£¼?¸ìš”"             }           />           {errors.password && <ErrMsg>{errors.password}</ErrMsg>}         </div>         <div>           <FormInputField             label={"ë¹„ë?ë²ˆí˜¸ ?•ì¸"}             type={"password"}             value={confirmPassword}             onChange={(e) => setConfirmPassword(e.target.value)}           />           {errors.confirmPassword && <ErrMsg>{errors.confirmPassword}</ErrMsg>}         </div>         <div>           <FormInputField             label={"?´ë???ë²ˆí˜¸"}             type={"phoneNumber"}             value={phoneNumber}             onChange={(e) => setPhoneNumber(e.target.value)}             hasError={errors.phoneNumber}             placeholder={"010-1234-1234"}           />           {errors.phoneNumber && <ErrMsg>{errors.phoneNumber}</ErrMsg>}         </div>          <Divider />         <BtnBox>           <Btn onClick={closeModal}>ì·¨ì†Œ</Btn>           <Btn type="submit">ê³„ì • ?ì„±?˜ê¸°</Btn>         </BtnBox>       </Form>     </Container>   ); }  export default UserDetailsInputForm;
