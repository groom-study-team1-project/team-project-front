import React from 'react';
import axiosInstance from "../axiosConfig"; import { MdCreditCard } from "react-icons/md"; import { IoDocumentsOutline } from "react-icons/io5"; import { GrUserSettings } from "react-icons/gr"; import { BsPatchQuestion } from "react-icons/bs"; import { imageUpload } from "./imageApi";  export const createPost = async (body) => {   try {     const requestBody = {       title: body.title?.trim(),       content: body.content?.trim(),       thumbnailImageUrl: body.thumbnailImageUrl || "posts/thumbnail.png",       categoryId: body.categoryId,       hashtags: body.hashtags || [],       imageKeys: body.imageKeys || [],     };      if (!requestBody.title || !requestBody.content || !requestBody.categoryId) {       throw new Error("?œëª©, ?´ìš©, ì¹´í…Œê³ ë¦¬ ID???„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??");     }      const result = await axiosInstance.post("/api/posts/upload", requestBody);     return result.data;   } catch (error) {     console.error(         error.response             ? `?œë²„ ?‘ë‹µ ?ëŸ¬: ${error.response.data}`             : error.request                 ? `?‘ë‹µ ?†ìŒ ?ëŸ¬: ${error.request}`                 : `?ˆìƒì¹?ëª»í•œ ?ëŸ¬: ${error.message}`     );     throw error;   } };  export const uploadAdapter = (loader, onImageUploaded) => {   const uploadImage = async (file) => {     if (!file) {       throw new Error("?…ë¡œ?œí•  ?Œì¼???†ìŠµ?ˆë‹¤.");     }      const response = await imageUpload("POST", file);     if (response.accessImage && response.fileKey) {       return response;     }      throw new Error("?´ë?ì§€ ?…ë¡œ???¤íŒ¨");   };    return {     upload: () => {       return loader.file           .then(uploadImage)           .then((response) => {             const { accessImage, fileKey } = response;             console.log("?´ë?ì§€ ?…ë¡œ???±ê³µ:", accessImage);              if (onImageUploaded) {               onImageUploaded(accessImage, fileKey);             }              return { default: accessImage };           })           .catch((error) => {             console.error("?´ë?ì§€ ?…ë¡œ???ëŸ¬:", error.message);             throw error;           });     },   }; };  export async function fetchPostItems(     categoryId,     lastPostId,     postSortType = "RECENT",     limit = 10 ) {   try {     const response = await axiosInstance.get("/open/posts", {       params: { categoryId, lastPostId, postSortType, limit },     });      if (         response.data?.status?.code === 1203 &&         Array.isArray(response.data.result)     ) {       console.log("ê²Œì‹œê¸€ ì¡°íšŒ ?±ê³µ:", response.data.result);       return { posts: response.data.result };     }      console.warn("?ˆìƒì¹?ëª»í•œ ?‘ë‹µ êµ¬ì¡° ?ëŠ” ê²°ê³¼ê°€ ë¹„ì–´ ?ˆìŠµ?ˆë‹¤.");     return { posts: [] };   } catch (error) {     console.error("ê²Œì‹œê¸€ ì¡°íšŒ ì¤??¤ë¥˜ ë°œìƒ:", error);     return { posts: [] };   } }  export const fetchPostDetail = async (postId) => {   try {     const response = await axiosInstance.get(`/open/posts/${postId}`);     console.log(response);     if (response.data.status.code === 1203) {       return response.data.result;     } else {       throw new Error(           response.data.status.message || "ê²Œì‹œê¸€ ?ì„¸ ì¡°íšŒ???¤íŒ¨?ˆìŠµ?ˆë‹¤."       );     }   } catch (error) {     console.error("ê²Œì‹œê¸€ ?ì„¸ ì¡°íšŒ ì¤??¤ë¥˜ ë°œìƒ:", error);     throw error;   } };  // ê²Œì‹œê¸€ ?˜ì • export const fetchPostChange = async (body, postId) => {   try {     const result = await axiosInstance.post(`/api/posts/edit/${postId}`, body);     return result.data;   } catch (error) {     console.error(         error.response             ? `?œë²„ ?‘ë‹µ ?ëŸ¬: ${error.response.data}`             : error.request                 ? `?‘ë‹µ ?†ìŒ ?ëŸ¬: ${error.request}`                 : `?ˆìƒì¹?ëª»í•œ ?ëŸ¬: ${error.message}`     );     throw error;   } };  export const deletepost = async (postId) => {   try {     const response = await axiosInstance.patch(`/api/posts/remove/${postId}`);     console.log("ê²Œì‹œê¸€ ?? œ ?±ê³µ:", response.data);     return response.data;   } catch (error) {     console.error(         error.response             ? `?œë²„ ?‘ë‹µ ?ëŸ¬: ${error.response.data}`             : error.request                 ? `?‘ë‹µ ?†ìŒ ?ëŸ¬: ${error.request}`                 : `?ˆìƒì¹?ëª»í•œ ?ëŸ¬: ${error.message}`     );     throw error;   } };  export async function fetchCategoryItems() {   try {     const response = await axiosInstance.get("/open/categories");     if (response.status === 200 || response.data.status.code === 9999) {       const categoryIconMap = {         ?ìœ ê²Œì‹œ?? <MdCreditCard />,         "?„ë¡œ?íŠ¸ ?ë‘ ê²Œì‹œ??: <IoDocumentsOutline />,         "ì§ˆë¬¸ ê²Œì‹œ??: <GrUserSettings />,         "ê³µì? ê²Œì‹œ??: <BsPatchQuestion />,       };        return response.data.result.map((category) => ({         ...category,         icon: categoryIconMap[category.title],       }));     }     throw new Error("ì¹´í…Œê³ ë¦¬ë¥?ë¶ˆëŸ¬?????†ìŠµ?ˆë‹¤.");   } catch (error) {     console.error("ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì¤??¤ë¥˜ ë°œìƒ:", error);     throw error;   } }  export const sortPostsByCriteria = async (category_id, sort, post_id) => {   try {     console.log(category_id, sort, post_id);   } catch (error) {     console.error("ê²Œì‹œê¸€ ?•ë ¬ ì¤??¤ë¥˜ ë°œìƒ:", error);   } };  export const fetchProjectPosts = async (     categoryId,     lastPostId,     postSortType = "LATEST",     limit = 10 ) => {   try {     const response = await axiosInstance.get("/open/posts/project", {       params: { categoryId, lastPostId, postSortType, limit },     });      if (response.data.status.code === 1203) {       console.log("Project ê²Œì‹œê¸€ ì¡°íšŒ ?±ê³µ:", response.data.result);       return { posts: response.data.result };     }      console.warn("?ˆìƒì¹?ëª»í•œ ?‘ë‹µ êµ¬ì¡° ?ëŠ” ê²°ê³¼ê°€ ë¹„ì–´ ?ˆìŠµ?ˆë‹¤.");     return { posts: [] };   } catch (error) {     console.error("Project ê²Œì‹œê¸€ ì¡°íšŒ ì¤??¤ë¥˜ ë°œìƒ:", error);     return { posts: [] };   } };  export const fetchProjectPostDetail = async (postId) => {   try {     const response = await axiosInstance.get(`/open/posts/project/${postId}`);     if (response.data.status.code === 1203) {       console.log("Project ê²Œì‹œê¸€ ?ì„¸ ì¡°íšŒ ?±ê³µ:", response.data.result);       return response.data.result;     } else {       throw new Error(           response.data.status.message || "?ì„¸ ì¡°íšŒ???¤íŒ¨?ˆìŠµ?ˆë‹¤."       );     }   } catch (error) {     console.error("Project ê²Œì‹œê¸€ ?ì„¸ ì¡°íšŒ ì¤??¤ë¥˜ ë°œìƒ:", error);     throw error;   } };  export const createProjectPost = async (body) => {   try {     const requestBody = {       title: body.title?.trim(),       content: body.content?.trim(),       thumbnailImageUrl: body.thumbnailImageUrl || "posts/thumbnail.png",       categoryId: body.categoryId,       hashtags: body.hashtags || [],       imageKeys: body.imageKeys || [],       slideImageKeys: body.slideImageKeys || [],     };      if (!requestBody.title || !requestBody.content || !requestBody.categoryId) {       throw new Error("?œëª©, ?´ìš©, ì¹´í…Œê³ ë¦¬ ID???„ìˆ˜ ?…ë ¥ ??ª©?…ë‹ˆ??");     }      console.log(requestBody);     const result = await axiosInstance.post(         "/api/posts/project/upload",         requestBody     );      console.log("ê²Œì‹œê¸€ ?ì„± ?±ê³µ:", result.data);     return result.data;   } catch (error) {     console.error(         error.response             ? "?œë²„ ?‘ë‹µ ?ëŸ¬: " + error.response.data             : error.request                 ? "?‘ë‹µ ?†ìŒ ?ëŸ¬: " + error.request                 : "?ˆìƒì¹?ëª»í•œ ?ëŸ¬: " + error.message     );     throw error;   } };  export const editProjectPost = async (postId, body) => {   try {     const response = await axiosInstance.post(         `/api/posts/project/edit/${postId}`,         body     );     return response.data;   } catch (error) {     console.error(         error.response             ? `?œë²„ ?‘ë‹µ ?ëŸ¬: ${error.response.data}`             : error.request                 ? `?‘ë‹µ ?†ìŒ ?ëŸ¬: ${error.request}`                 : `?ˆìƒì¹?ëª»í•œ ?ëŸ¬: ${error.message}`     );     throw error;   } };  export const deleteProjectPost = async (projectId) => {   try {     const response = await axiosInstance.delete(         `/api/posts/project/remove/${projectId}`     );     console.log("?„ë¡œ?íŠ¸ ê²Œì‹œê¸€ ?? œ ?±ê³µ:", response.data);     return response.data;   } catch (error) {     console.error(         error.response             ? `?œë²„ ?‘ë‹µ ?ëŸ¬: ${error.response.data}`             : error.request                 ? `?‘ë‹µ ?†ìŒ ?ëŸ¬: ${error.request}`                 : `?ˆìƒì¹?ëª»í•œ ?ëŸ¬: ${error.message}`     );     throw error;   } };
